<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de cadastro</title><!--nota: isso é temporario para eu poder testar o cadastro-->
</head>
<body>
    <form id="cadastro_form">
        <label for="nome">Nome</label>
        <input type="text" id="nome" name="nome" required>
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required>
        <label for="senha">Senha</label>
        <input type="password" id="senha" name="senha" required>

        <button type="submit">Cadastrar</button>
    </form>
    <button id="atualizar">mostrar cadastro</button>
    <h1 id="banco_info"></h1>

    <script>
        const url = 'http://localhost:3000'//o caminho do server 

        const formCadastro = document.getElementById('cadastro_form')
        formCadastro.addEventListener('submit', async (event) => {
            event.preventDefault()//não deixa que o navegador recarrega quando clicar no botão

            const cadastroForm = new FormData(formCadastro)
            const cadastroData =Object.fromEntries(cadastroForm.entries())//transforma o forms em um object
            try{
                const resposta = await fetch(`${url}/items`, {
                    method:'POST',
                    headers: {'content-type': 'application/json'},
                    body: JSON.stringify(cadastroData)
                })
                
                if (!resposta.ok) {
                    const erroTexto = await resposta.text();
                    throw new Error(`Erro no servidor:${erroTexto}`);
                }

                const mensagemSucesso = await resposta.text();
                console.log(mensagemSucesso);
                alert('Cadastro Salvo');
                formCadastro.reset();
            }
            catch(error) {console.log(error)}
        })


        const atu = document.getElementById('atualizar')
        atu.addEventListener('click', async (event) => {
            try{
                const resposta = await fetch(`${url}/items`, {
                    method:'GET',
                })
                if (!resposta.ok) {
                    const erroTexto = await resposta.text();
                    throw new Error(`Erro no servidor:${erroTexto}`);
                }

                const dados = await resposta.json()

                const botaoMostrar = document.getElementById('banco_info')
                botaoMostrar.innerHTML = JSON.stringify(dados)
            }
            catch(error) {console.log(error)}  
        })
    </script> 
</body>
</html>